<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Spin Wheel Game</title>
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #040761 0%, #02006d 50%, #0e156b 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            margin: 0 auto;
            padding: 15px;
            max-width: 1400px;
            width: 100%;
        }

        .game-layout {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        @media (min-width: 1024px) {
            .game-layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 40px;
            }
        }

        /* Wheel Sections */
        .wheels-container {
            display: flex;
            flex-direction: column;
        }

        .wheel-section {
            position: relative;
            border-radius: 16px;
            border: 1px solid rgba(99, 102, 241, 0.4);
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            padding: 15px;
        }

        .wheel-label {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 16px;
            border-radius: 9999px;
            background: #e0e7ff;
            color: black;
            font-weight: bold;
            font-size: 16px;
            letter-spacing: 0.05em;
            z-index: 10;
            min-width: 40px;
            text-align: center;
        }

        .wheels-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            position: relative;
            padding-top: 10px;
        }

        /* Spin Wheel Component */
        .wheel-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 10px;
        }

        @media (min-width: 768px) {
            .wheel-container {
                width: 150px;
                height: 150px;
            }
        }

        @media (min-width: 1024px) {
            .wheel-container {
                width: 200px;
                height: 200px;
            }
        }

        @media (min-width: 1400px) {
            .wheel-container {
                width: 250px;
                height: 250px;
            }
        }

        .wheel-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #facc15, #ec4899, #a855f7);
            filter: blur(16px);
            opacity: 0.3;
        }

        .wheel-rim {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: #fbbf24;
            border: 4px solid #d97706;
        }

        .wheel-arrow {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 14px solid #FFD700;
        }

        @media (min-width: 768px) {
            .wheel-arrow {
                top: -16px;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-bottom: 18px solid #FFD700;
            }
        }

        .wheel-main {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border-radius: 50%;
            transition: transform 7s ease-out;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .wheel-main {
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
            }
        }

        /* NEW: Canvas-based wheel for older browsers */
        .wheel-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .wheel-numbers-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            z-index: 2;
        }

        .wheel-number {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            transform-origin: center;
        }

        .wheel-number span {
            margin-top: 10px;
            font-size: 12px;
            font-weight: 800;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        @media (min-width: 768px) {
            .wheel-number span {
                margin-top: 14px;
                font-size: 16px;
            }
        }

        @media (min-width: 1024px) {
            .wheel-number span {
                margin-top: 18px;
                font-size: 20px;
            }
        }

        @media (min-width: 1400px) {
            .wheel-number span {
                margin-top: 24px;
                font-size: 24px;
            }
        }

        .wheel-center-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fef3c7, #fbbf24, #d97706);
            border: 1px solid rgba(253, 224, 71, 0.8);
            cursor: pointer;
        }

        @media (min-width: 768px) {
            .wheel-center-button {
                width: 50px;
                height: 50px;
            }
        }

        @media (min-width: 1024px) {
            .wheel-center-button {
                width: 60px;
                height: 60px;
            }
        }

        /* Selection Dropdown */
        .selection-container {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .selection-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(250, 204, 21, 0.5);
            padding: 5px;
        }

        @media (min-width: 768px) {
            .selection-box {
                padding: 8px 12px;
            }
        }

        .selection-inputs {
            display: flex;
            gap: 5px;
            z-index: 20;
        }

        .wheel-select {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 16px;
            font-weight: 800;
            color: #fde047;
            background: linear-gradient(180deg, #000, #18181b);
            border-radius: 6px;
            border: 1px solid rgba(234, 179, 8, 0.7);
            cursor: pointer;
        }

        @media (min-width: 768px) {
            .wheel-select {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
        }

        @media (min-width: 1024px) {
            .wheel-select {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
        }

        .wheel-select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Info Panel */
        .info-panel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 20px;
        }

        .game-timing {
            width: 100%;
            border-radius: 16px;
            border: 1px solid rgba(251, 113, 133, 0.4);
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
        }

        .game-timing-label {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.25em;
            color: #fb7185;
            margin-bottom: 8px;
        }

        .timing-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .time-badge {
            padding: 5px 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            color: #fde047;
            font-weight: bold;
            font-size: 14px;
        }

        /* Timer Box */
        .timer-box {
            width: 100%;
            border-radius: 16px;
            border: 1px solid rgba(250, 204, 21, 0.7);
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
        }

        .timer-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: 0.025em;
        }

        .timer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .timer-item {
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(67, 56, 202, 0.5), rgba(49, 46, 129, 0.5));
            padding: 15px;
        }

        .timer-value {
            font-size: 32px;
            font-weight: bold;
            color: #fde047;
        }

        @media (min-width: 768px) {
            .timer-value {
                font-size: 36px;
            }
        }

        .timer-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #d1d5db;
            margin-top: 4px;
        }

        /* Results Display */
        .results-container {
            width: 100%;
            cursor: pointer;
        }

        .results-box {
            border-radius: 16px;
            border: 1px solid rgba(250, 204, 21, 0.6);
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
        }

        .results-title {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.05em;
            color: #fde047;
        }

        .results-subtitle {
            margin-top: 8px;
            text-align: center;
            font-size: 14px;
            color: #9ca3af;
        }

        .results-content {
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .result-item {
            border-radius: 12px;
            border: 1px solid rgba(250, 204, 21, 0.3);
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            text-align: center;
        }

        .result-label {
            font-size: 24px;
            font-weight: 600;
            color: #f3f4f6;
            margin-bottom: 5px;
        }

        @media (min-width: 768px) {
            .result-label {
                font-size: 32px;
            }
        }

        @media (min-width: 1024px) {
            .result-label {
                font-size: 40px;
            }
        }

        .result-value {
            font-size: 28px;
            font-weight: bold;
            color: #fde047;
        }

        @media (min-width: 768px) {
            .result-value {
                font-size: 32px;
            }
        }

        @media (min-width: 1024px) {
            .result-value {
                font-size: 36px;
            }
        }

        /* Game Closed Overlay */
        .game-closed {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .game-closed-content {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        .game-closed-icon {
            font-size: 60px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .game-closed-icon {
                font-size: 80px;
            }
        }

        .game-closed-title {
            font-size: 28px;
            font-weight: bold;
            color: #fde047;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .game-closed-title {
                font-size: 36px;
            }
        }

        .game-closed-description {
            font-size: 16px;
            color: #d1d5db;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .game-closed-description {
                font-size: 20px;
            }
        }

        .countdown-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(250, 204, 21, 0.3);
            margin-bottom: 30px;
        }

        .countdown-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .countdown-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .countdown-item {
            background: rgba(67, 56, 202, 0.5);
            border-radius: 12px;
            padding: 15px 20px;
            min-width: 80px;
        }

        .countdown-value {
            font-size: 24px;
            font-weight: bold;
            color: #fde047;
        }

        @media (min-width: 768px) {
            .countdown-value {
                font-size: 32px;
            }
        }

        .countdown-label {
            font-size: 14px;
            color: #d1d5db;
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <div id="app"></div>

    <script>
        // Game configuration
        var prizes = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
        var colors = [
            "#EC2721", "#008200", "#EC2721", "#008200", "#EC2721",
            "#008200", "#EC2721", "#ff4c4c", "#444C38", "#16a34a"
        ];

        // Game state
        var state = {
            spinning: false,
            isWaiting: false,
            gameClosed: false,
            isGameActive: false,
            currentRound: 1,
            roundTimeLeft: 0,
            timeUntilNextGame: 0,
            nextGameStart: null,
            token: null,
            socket: null,
            results: { a1: null, a2: null, b1: null, b2: null, c1: null, c2: null },
            serverWheelValues: { a1: null, a2: null, b1: null, b2: null, c1: null, c2: null },
            userSelections: { a1: undefined, a2: undefined, b1: undefined, b2: undefined, c1: undefined, c2: undefined }
        };

        var wheelRotations = { a1: 0, a2: 0, b1: 0, b2: 0, c1: 0, c2: 0 };
        var canvasElements = {};

        // Initialize the game
        function init() {
            state.token = sessionStorage.getItem("token");
            initializeSocket();
            initialRender();
            startTimerUpdate();
        }

        // Socket connection
        function initializeSocket() {
            try {
                var socket = io('https://gamebackend-l3pd.onrender.com', { 
                    path: '/api/socket',
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionAttempts: 10,
                    reconnectionDelay: 1000
                });
                
                state.socket = socket;

                socket.on('connect', function() {
                    console.log('Connected to game server');
                });

                socket.on('connect_error', function(err) {
                    console.log('Connection error:', err);
                });

                socket.on('game-state', handleGameState);
                socket.on('game-timer', handleGameTimer);
                socket.on('round-start', handleRoundStart);
                socket.on('wheel-values-update', handleWheelValuesUpdate);
                socket.on('game-closed', handleGameClosed);

            } catch (error) {
                console.error('Socket initialization error:', error);
                setTimeout(function() {
                    handleGameState({
                        isActive: true,
                        currentRound: 1,
                        roundTimeLeft: 300,
                        timeUntilEnd: 600
                    });
                }, 1000);
            }
        }

        // Socket event handlers
        function handleGameState(data) {
            state.isGameActive = data.isActive;
            state.gameClosed = !data.isActive;
            state.currentRound = data.currentRound || 1;
            state.roundTimeLeft = data.roundTimeLeft || 0;
            state.timeUntilNextGame = data.timeUntilEnd || 0;
            state.nextGameStart = data.nextGameStart || null;
            if (data.currentResults) {
                for (var key in data.currentResults) {
                    if (data.currentResults.hasOwnProperty(key)) {
                        state.results[key] = data.currentResults[key];
                    }
                }
            }
            fullRender();
        }

        function handleGameTimer(data) {
            state.roundTimeLeft = data.roundTimeLeft;
            state.currentRound = data.roundNumber;
            state.isGameActive = data.isActive;
            updateTimerOnly();
        }

        function handleRoundStart(data) {
            state.currentRound = data.roundNumber;
            state.roundTimeLeft = data.roundTimeLeft;
            state.spinning = true;
            state.isWaiting = true;
            state.serverWheelValues = data.wheelValues;
            
            // Reset results
            var resetResults = { a1: null, a2: null, b1: null, b2: null, c1: null, c2: null };
            for (var key in resetResults) {
                state.results[key] = resetResults[key];
            }

            var wheelKeys = ['a1', 'a2', 'b1', 'b2', 'c1', 'c2'];
            wheelKeys.forEach(function(key) {
                spinWheel(key, state.serverWheelValues[key]);
            });

            updateSelectorsState();
        }

        function handleWheelValuesUpdate(data) {
            state.serverWheelValues = data.wheelValues;
        }

        function handleGameClosed(data) {
            state.gameClosed = true;
            state.isGameActive = false;
            state.timeUntilNextGame = data.timeUntilNextGame;
            state.nextGameStart = data.nextGameStart;
            fullRender();
        }

        // NEW: Draw wheel using Canvas (works in all browsers)
        function drawWheelCanvas(wheelKey, rotation) {
            var canvas = canvasElements[wheelKey];
            if (!canvas) return;
            
            var ctx = canvas.getContext('2d');
            var width = canvas.width;
            var height = canvas.height;
            var centerX = width / 2;
            var centerY = height / 2;
            var radius = Math.min(width, height) / 2;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Draw colored segments
            var sliceAngle = (2 * Math.PI) / prizes.length;
            
            // Apply rotation
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation * Math.PI / 180);
            ctx.translate(-centerX, -centerY);
            
            for (var i = 0; i < prizes.length; i++) {
                var startAngle = i * sliceAngle;
                var endAngle = startAngle + sliceAngle;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                
                ctx.fillStyle = colors[i];
                ctx.fill();
                
                // Add border between segments
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle);
                ctx.lineTo(centerX, centerY);
                ctx.closePath();
                
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // Draw center circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.15, 0, 2 * Math.PI);
            ctx.closePath();
            ctx.fillStyle = '#fbbf24';
            ctx.fill();
            ctx.strokeStyle = '#d97706';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.restore();
        }

        // Wheel spinning logic
        function spinWheel(wheelKey, value) {
            var hasInput = typeof value === "number" && value >= 0 && value < prizes.length;
            var selectedIndex = hasInput ? value : Math.floor(Math.random() * prizes.length);

            var sliceAngle = 360 / prizes.length;
            var randomRounds = Math.floor(Math.random() * 6) + 10;
            var fullRotation = randomRounds * 360;
            var sliceCenter = selectedIndex * sliceAngle + sliceAngle / 2;

            var currentAngle = wheelRotations[wheelKey] % 360;
            var targetAngle = 360 - sliceCenter - 110;
            wheelRotations[wheelKey] += fullRotation + (targetAngle - currentAngle);

            // Update canvas rotation
            if (canvasElements[wheelKey]) {
                drawWheelCanvas(wheelKey, wheelRotations[wheelKey]);
            }

            // Update CSS transform for modern browsers
            var wheelElement = document.querySelector('[data-wheel="' + wheelKey + '"] .wheel-main');
            if (wheelElement) {
                wheelElement.style.transform = 'rotate(' + wheelRotations[wheelKey] + 'deg)';
            }

            // Update numbers rotation
            var numbersContainer = document.querySelector('[data-wheel="' + wheelKey + '"] .wheel-numbers-container');
            if (numbersContainer) {
                numbersContainer.style.transform = 'rotate(' + (-wheelRotations[wheelKey]) + 'deg)';
            }

            setTimeout(function() {
                state.results[wheelKey] = selectedIndex;

                var allWheelsFinished = true;
                for (var key in state.results) {
                    if (state.results[key] === null) {
                        allWheelsFinished = false;
                        break;
                    }
                }

                if (allWheelsFinished) {
                    state.spinning = false;
                    state.isWaiting = false;
                    updateResultsDisplay();
                    updateSelectorsState();
                }
            }, 7000);
        }

        // Wheel rendering
        function createWheel(wheelKey) {
            var sliceAngle = 360 / prizes.length;
            
            // Create numbers HTML
            var numbersHtml = '';
            for (var i = 0; i < prizes.length; i++) {
                numbersHtml += '<div class="wheel-number" style="transform: rotate(' + (i * sliceAngle + sliceAngle / 2) + 'deg);">' +
                               '<span>' + prizes[i] + '</span>' +
                               '</div>';
            }

            return '<div class="wheel-container" data-wheel="' + wheelKey + '">' +
                   '<div class="wheel-glow"></div>' +
                   '<div class="wheel-rim"></div>' +
                   '<div class="wheel-arrow"></div>' +
                   '<div class="wheel-main" style="background: conic-gradient(' + 
                   colors.map(function(color, index) {
                       var start = (index * 100 / prizes.length) + '%';
                       var end = ((index + 1) * 100 / prizes.length) + '%';
                       return color + ' ' + start + ' ' + end;
                   }).join(', ') + 
                   '); transform: rotate(' + wheelRotations[wheelKey] + 'deg);">' +
                   '</div>' +
                   '<canvas class="wheel-canvas" id="canvas-' + wheelKey + '" width="300" height="300"></canvas>' +
                   '<div class="wheel-numbers-container" style="transform: rotate(' + (-wheelRotations[wheelKey]) + 'deg);">' +
                   numbersHtml +
                   '</div>' +
                   '<button class="wheel-center-button"></button>' +
                   '</div>';
        }

        function createWheelSection(label, wheel1Key, wheel2Key) {
            var showSelections = state.token !== null;
            var selectionsHtml = '';

            if (showSelections) {
                var options1 = '<option value="">X</option>';
                var options2 = '<option value="">X</option>';
                
                for (var i = 0; i < prizes.length; i++) {
                    var selected1 = state.userSelections[wheel1Key] === i ? ' selected' : '';
                    var selected2 = state.userSelections[wheel2Key] === i ? ' selected' : '';
                    options1 += '<option value="' + i + '"' + selected1 + '>' + prizes[i] + '</option>';
                    options2 += '<option value="' + i + '"' + selected2 + '>' + prizes[i] + '</option>';
                }

                selectionsHtml = '<div class="selection-container">' +
                                '<div class="selection-box">' +
                                '<div class="selection-inputs">' +
                                '<select class="wheel-select" data-select="' + wheel1Key + '"' + (state.spinning ? ' disabled' : '') + '>' +
                                options1 +
                                '</select>' +
                                '<select class="wheel-select" data-select="' + wheel2Key + '"' + (state.spinning ? ' disabled' : '') + '>' +
                                options2 +
                                '</select>' +
                                '</div>' +
                                '</div>' +
                                '</div>';
            }

            return '<div class="wheel-section">' +
                   '<span class="wheel-label">' + label + '</span>' +
                   '<div class="wheels-grid">' +
                   createWheel(wheel1Key) +
                   createWheel(wheel2Key) +
                   selectionsHtml +
                   '</div>' +
                   '</div>';
        }

        // Initialize canvas after DOM is rendered
        function initializeWheelCanvases() {
            var wheelKeys = ['a1', 'a2', 'b1', 'b2', 'c1', 'c2'];
            wheelKeys.forEach(function(key) {
                var canvas = document.getElementById('canvas-' + key);
                if (canvas) {
                    canvasElements[key] = canvas;
                    // Set actual size from computed style
                    var container = canvas.parentElement;
                    var rect = container.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    drawWheelCanvas(key, wheelRotations[key]);
                }
            });
        }

        // Timer utilities
        function getMinutesAndSeconds(timeLeft) {
            var minutes = Math.floor(timeLeft / 60);
            var seconds = timeLeft % 60;
            return { minutes: minutes, seconds: seconds };
        }

        function formatTimeNumber(num) {
            return num < 10 ? '0' + num : num.toString();
        }

        // Rendering
        function initialRender() {
            fullRender();
        }

        function fullRender() {
            var app = document.getElementById('app');
            if (!app) return;

            if (state.gameClosed) {
                renderGameClosed(app);
            } else {
                renderGameActive(app);
            }
            
            // Initialize canvases after a short delay to ensure DOM is ready
            setTimeout(function() {
                initializeWheelCanvases();
                attachEventListeners();
            }, 100);
        }

        function renderGameClosed(app) {
            var nextGameTime = '9:00 AM';
            if (state.nextGameStart && !isNaN(state.nextGameStart.getTime())) {
                nextGameTime = state.nextGameStart.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    hour12: true 
                });
            }

            var hours = Math.floor(state.timeUntilNextGame / 3600);
            var minutes = Math.floor((state.timeUntilNextGame % 3600) / 60);
            var seconds = state.timeUntilNextGame % 60;

            app.innerHTML = '<div class="game-closed">' +
                           '<div class="game-closed-content">' +
                           '<div class="game-closed-icon">ðŸŒ™</div>' +
                           '<h1 class="game-closed-title">Game Closed</h1>' +
                           '<p class="game-closed-description">The game is currently closed. Next game starts tomorrow at ' + nextGameTime + '.</p>' +
                           '<div class="countdown-box">' +
                           '<p class="countdown-title">Next Game Countdown</p>' +
                           '<div class="countdown-grid">' +
                           '<div class="countdown-item">' +
                           '<p class="countdown-value" id="closed-hours">' + formatTimeNumber(hours) + '</p>' +
                           '<p class="countdown-label">Hours</p>' +
                           '</div>' +
                           '<div class="countdown-item">' +
                           '<p class="countdown-value" id="closed-minutes">' + formatTimeNumber(minutes) + '</p>' +
                           '<p class="countdown-label">Minutes</p>' +
                           '</div>' +
                           '<div class="countdown-item">' +
                           '<p class="countdown-value" id="closed-seconds">' + formatTimeNumber(seconds) + '</p>' +
                           '<p class="countdown-label">Seconds</p>' +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '<p class="game-closed-footer">Please check back tomorrow for the next game session.</p>' +
                           '</div>' +
                           '</div>';
        }

        function renderGameActive(app) {
            var timeData = getMinutesAndSeconds(state.isGameActive ? state.roundTimeLeft : state.timeUntilNextGame);
            var minutes = formatTimeNumber(timeData.minutes);
            var seconds = formatTimeNumber(timeData.seconds);

            // Create results grid HTML
            var resultsGridHtml = '';
            var labels = ['A', 'B', 'C'];
            
            for (var i = 0; i < labels.length; i++) {
                var label = labels[i];
                var key1 = label.toLowerCase() + '1';
                var key2 = label.toLowerCase() + '2';
                var val1 = state.results[key1] !== null ? state.results[key1] : 'â€”';
                var val2 = state.results[key2] !== null ? state.results[key2] : 'â€”';
                
                resultsGridHtml += '<div class="result-item">' +
                                 '<div class="result-label">' + label + '</div>' +
                                 '<div class="result-value">' + val1 + val2 + '</div>' +
                                 '</div>';
            }

            app.innerHTML = '<div class="container">' +
                           '<div class="game-layout">' +
                           '<div class="wheels-container">' +
                           createWheelSection('A', 'a1', 'a2') +
                           createWheelSection('B', 'b1', 'b2') +
                           createWheelSection('C', 'c1', 'c2') +
                           '</div>' +
                           '<div class="info-panel">' +
                           '<div class="game-timing">' +
                           '<p class="game-timing-label">GAME RESULT TIMING</p>' +
                           '<div class="timing-display">' +
                           '<span class="time-badge">09:00 AM</span>' +
                           '<span>TO</span>' +
                           '<span class="time-badge">09:00 PM</span>' +
                           '</div>' +
                           '</div>' +
                           '<div class="timer-box">' +
                           '<p class="timer-title">Results On Time</p>' +
                           '<div class="timer-grid">' +
                           '<div class="timer-item">' +
                           '<p class="timer-value" id="timer-minutes">' + minutes + '</p>' +
                           '<p class="timer-label">Minute</p>' +
                           '</div>' +
                           '<div class="timer-item">' +
                           '<p class="timer-value" id="timer-seconds">' + seconds + '</p>' +
                           '<p class="timer-label">Second</p>' +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '<div class="results-container">' +
                           '<div class="results-box">' +
                           '<p class="results-title">Result</p>' +
                           '<p class="results-subtitle">Old Result Click here</p>' +
                           '<div class="results-content">' +
                           '<div class="results-grid" id="results-grid">' +
                           resultsGridHtml +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '</div>' +
                           '</div>';
        }

        // Update functions
        function updateTimerOnly() {
            var minutesEl = document.getElementById('timer-minutes');
            var secondsEl = document.getElementById('timer-seconds');
            
            if (minutesEl && secondsEl) {
                var timeData = getMinutesAndSeconds(state.isGameActive ? state.roundTimeLeft : state.timeUntilNextGame);
                minutesEl.textContent = formatTimeNumber(timeData.minutes);
                secondsEl.textContent = formatTimeNumber(timeData.seconds);
            }

            // Update closed game countdown
            var closedHours = document.getElementById('closed-hours');
            var closedMinutes = document.getElementById('closed-minutes');
            var closedSeconds = document.getElementById('closed-seconds');

            if (closedHours && closedMinutes && closedSeconds) {
                var hours = Math.floor(state.timeUntilNextGame / 3600);
                var minutes = Math.floor((state.timeUntilNextGame % 3600) / 60);
                var seconds = state.timeUntilNextGame % 60;

                closedHours.textContent = formatTimeNumber(hours);
                closedMinutes.textContent = formatTimeNumber(minutes);
                closedSeconds.textContent = formatTimeNumber(seconds);
            }
        }

        function updateResultsDisplay() {
            var resultsGrid = document.getElementById('results-grid');
            if (!resultsGrid) return;

            var resultsGridHtml = '';
            var labels = ['A', 'B', 'C'];
            
            for (var i = 0; i < labels.length; i++) {
                var label = labels[i];
                var key1 = label.toLowerCase() + '1';
                var key2 = label.toLowerCase() + '2';
                var val1 = state.results[key1] !== null ? state.results[key1] : 'â€”';
                var val2 = state.results[key2] !== null ? state.results[key2] : 'â€”';
                
                resultsGridHtml += '<div class="result-item">' +
                                 '<div class="result-label">' + label + '</div>' +
                                 '<div class="result-value">' + val1 + val2 + '</div>' +
                                 '</div>';
            }
            
            resultsGrid.innerHTML = resultsGridHtml;
        }

        function updateSelectorsState() {
            var selects = document.querySelectorAll('.wheel-select');
            for (var i = 0; i < selects.length; i++) {
                selects[i].disabled = state.spinning;
            }
        }

        // Timer update interval
        function startTimerUpdate() {
            setInterval(function() {
                if (state.isGameActive && state.roundTimeLeft > 0) {
                    state.roundTimeLeft--;
                    updateTimerOnly();
                } else if (state.gameClosed && state.timeUntilNextGame > 0) {
                    state.timeUntilNextGame--;
                    updateTimerOnly();
                }
            }, 1000);
        }

        // Event listeners
        function attachEventListeners() {
            var selects = document.querySelectorAll('[data-select]');
            for (var i = 0; i < selects.length; i++) {
                selects[i].addEventListener('change', function(e) {
                    var wheelKey = e.target.getAttribute('data-select');
                    var value = e.target.value === '' ? undefined : parseInt(e.target.value);
                    state.userSelections[wheelKey] = value;

                    if (state.socket) {
                        state.socket.emit('user-selection', {
                            userSelections: state.userSelections,
                            timestamp: Date.now()
                        });
                    }
                });
            }

            // Results container click
            var resultsContainer = document.querySelector('.results-container');
            if (resultsContainer) {
                resultsContainer.addEventListener('click', function() {
                    window.location.href = '/history';
                });
            }
        }

        // Handle window resize for canvas
        window.addEventListener('resize', function() {
            setTimeout(function() {
                for (var key in canvasElements) {
                    if (canvasElements.hasOwnProperty(key)) {
                        var canvas = canvasElements[key];
                        var container = canvas.parentElement;
                        if (container) {
                            var rect = container.getBoundingClientRect();
                            canvas.width = rect.width;
                            canvas.height = rect.height;
                            drawWheelCanvas(key, wheelRotations[key]);
                        }
                    }
                }
            }, 100);
        });

        // Start the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>